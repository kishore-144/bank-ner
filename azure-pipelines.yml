# Azure DevOps pipeline for building and running a Python Docker app on self-hosted agent

trigger:
- main  # change to your branch if needed

pool:
  name: Default          # the agent pool where your Linux VM agent is registered
  demands:
    - agent.os -equals Linux

variables:
  imageName: 'bank-ner-app'       # name of the Docker image
  tag: '$(Build.BuildId)'         # unique tag for each build

stages:
- stage: Build
  displayName: Build Docker Image
  jobs:
  - job: Build
    displayName: Build
    steps:
    - task: Docker@2
      displayName: Build Docker Image
      inputs:
        command: build
        dockerfile: '$(Build.SourcesDirectory)/Dockerfile'
        tags: |
          $(imageName):$(tag)
          $(imageName):latest

    - task: Docker@2
      displayName: Run Docker Container
      inputs:
        command: run
        containerName: 'bank-ner-container'
        imageName: '$(imageName):latest'
        ports: '8000:8000'  # change if your app uses a different port
